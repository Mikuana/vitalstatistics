---
title: "Day of Week Exploration"
subtitle: "Vital Statistics"
author: "Christopher Boyd, MPA"
output:
  tufte::tufte_html: default
bibliography: skeleton.bib
link-citations: yes
---

```{r setup, echo=FALSE}
knitr::read_chunk('chunks.R')
library(knitr)
library(tufte)
suppressMessages(library(vitalstatistics))
suppressMessages(library(dplyr))
library(ggplot2)
```

```{r page-defaults, echo=FALSE, results='asis'}
```

`r tufte::margin_note('[Home Page](index)')`
`r tufte::margin_note('[Directory](directory)')`

# Summary

This document shows that births tend to occur much more frequently on weekdays, and in the middle of the week in particular. This effect was less prevalent in the 70's, but has become more pronounced in recent years.

# Analysis

```{r data-prep}
b.dow = copy(births)  # using a shorthand name for modified data set
```

One of the attributes that we have a nearly complete record for is day of the week. Unfortunately 1968 is completely lacking day of week data, but after 1968 there is less than 1/10th of a percent of records missing from any year.

## Exploration

```{r dow-prep}
b.dow = b.dow[!is.na(birth_weekday_date)]
ext_suite.birth_date(b.dow)
# Relabel decade since 1968 is excluded by filtering
b.dow = mutate(b.dow, birth_decade = recode(birth_decade, '1968/9' = '1969'))
```

Our exploration of this attribute is primarily interested in the distribution of births in any given week. In other words, we are interested to know if more births tend to occur on Friday, as opposed to Monday. Our assumption here is that there should be no _biological_ reason why births favor any particular weekday, and therefore any bias is the result of manmade systems.

In our first figure, we graph this distribution as a percentage with an additional line at 14.3% (i.e. `1/7`), which is where the weekly share of births would fall for each day if there was no bias toward any particular day. 

```{r all-dist, fig.fullwidth=TRUE}
dow.plot = function(dat) {  # create ggplot function for multiple use
    ggplot(dat, aes(birth_weekday, weekly_share, label=scales::percent(weekly_share))) +
        geom_hline(yintercept = 1/7, col="red") +  # draw a line at 14.3%
        geom_bar(stat="identity", alpha=0.80) +
        geom_label() +
        scale_y_continuous(labels=scales::percent) +
        coord_cartesian(ylim=c(0.07, 0.18)) +
        xlab("Birth Day of Week") +
        ylab("Distribution of Births in Week (%)")
}

b.dow %>%
  group_by(birth_weekday) %>%
  summarise(live_births = sum(cases)) %>%
  mutate(weekly_share = live_births / sum(live_births)) %>%
  dow.plot(.) + geom_label(aes(1, 1/7, label=scales::percent(1/7)))
```

The graph reveals that births are *not* evenly distributed, with births much more heavily weighted towards weekdays than weekends. Sunday in particular falls well below the 14.3% non-bias level. To dive a little deeper into this question while still remaining at the "exploratory" level of analysis, we look at how this distribution has changed over time.

We recast this graphic with a facet for each weekday, track the decade on the y-axis, and plot our outcomes as a line instead of a bar. This allows us to much more easily discern how frequently births occur on certain days over time. Again, we include a red line to indicate the point which each day would fall if there were no bias towards particular days of the week.

```{r decade-dist, fig.fullwidth=TRUE}
b.dow.decades = b.dow %>%
    group_by(birth_weekday, birth_decade) %>%
    summarise(live_births = sum(cases)) %>%
    group_by(birth_decade) %>%  # group again on summarized data for denominator calculation
    mutate(weekly_share = live_births / sum(live_births))

b.dow.decades %>%
    ggplot(aes(birth_decade, weekly_share, group=birth_weekday)) + 
        facet_grid(. ~ birth_weekday) +
        geom_hline(yintercept = 1/7, col="red") +
        geom_line(stat='identity') +
        scale_y_continuous(labels=scales::percent)+
        coord_cartesian(ylim=c(0.07, 0.18)) +
        theme(axis.text.x=element_text(angle=90, size=8)) +
        xlab("Decade of Birth") +
        ylab("Distribution of Births in Week (%)")
```

With this final graphic, it becomes extremely clear that (1) births are much more heavily biased towards weekdays, (2) births are biased towards the middle of the week in particular, and (3) this trend has become more extreme over time. 

But what does this mean in plain language? We'll propose a theoretical week in which 7000 births occur. If there was no bias on which day they were born and births occurred completely randomly, then ~1000 births would occur on each day. However, as of the 2010s, the week would probably look like this:

```{r}
b.dow.decades %>%
    filter(birth_decade == '2010s') %>%
    mutate(est = round(weekly_share / (1/7) * 1000, 0)) %>%
    group_by %>%  # drop decades grouping
    select(
        Weekday = birth_weekday,
        `Estimated Births` = est
    ) %>%
    knitr::kable(., format="markdown", align = "r")
```
